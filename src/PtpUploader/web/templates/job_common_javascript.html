{% load static %}

{% block job_common_javascript %}

  <script src="{% static "script/jquery-3.6.0.min.js" %}"></script>
  <script src="{% static "script/select2.min.js" %}"></script>
  <link href="{% static "script/select2.min.css" %}" rel="stylesheet" type="text/css" />
  <link href="//cdn.jsdelivr.net/npm/jquery.fancytree@2.27/dist/skin-win8/ui.fancytree.min.css" rel="stylesheet">
  <script src="//cdn.jsdelivr.net/npm/jquery.fancytree@2.27/dist/jquery.fancytree-all-deps.min.js"></script>
  <script src="//code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-contextmenu/2.7.1/jquery.contextMenu.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-contextmenu/2.7.1/jquery.contextMenu.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-contextmenu/2.7.1/jquery.ui.position.js"></script>
  <script>
   function FinishSkipDuplicateCheckingAjaxCall( torrentId, uploadedAgo )
   {
     $( "html" ).removeClass( 'busy' );
     $( "#SkipDuplicateCheckingButton" ).val( torrentId );
     $( "#SkipDuplicateCheckingMessage" ).html( uploadedAgo );

     if ( torrentId <= 0 )
     {
       alert( "Error!" );
       $( "#SkipDuplicateCheckingButton" ).attr( "checked", false );
     }
   }

   $(function () {
     $( ".show_images" ).click(function() {
       console.log("#"+$(this).data("target"));
       $("#"+$(this).data("target")).toggle();
       if ($(this).text() == "Show") {
         $(this).text("Hide");
       } else {
         $(this).text("Show");
       }
     });
     $( "#id_Subtitles" ).select2({
       width: '80%'
     });
     {# $( "#genre_tags" ).val( {{ job.Tags|tojson|safe }} ); #}
     $( "#genre_tags" ).trigger("change");

     $( "#genre_tags" ).select2({
       width: '90%',
       placeholder: '---'
     });

     $( "#ConvertComparisonCode" ).click( function()
       {
	 var releaseNotes = $( "#ReleaseNotes" );

	 var text = releaseNotes.val().replace( /<b>/gi, "" );
	 text = text.replace( /<\/b>/gi, "" );
	 text = text.replace( /<font.*?>/gi, "" );
	 text = text.replace( /<\/font>/gi, "" );
	 text = text.replace( /<br>/gi, "\n" );
	 text = text.replace( /&nbsp;/gi, " " );
	 // E.g.: <a href="http://www.imagebam.com/image/50a6ce137826241" target="_blank"><img id="ncode_imageresizer_container_1" src="http://thumbnails43.imagebam.com/13783/50a6ce137826241.jpg" alt="" onload="NcodeImageResizer.createOn(this);" border="0"></a>
	 text = text.replace( /<a.*?href="(.+?)".*?><img.*?src="(.+?)".*?>.*?<\/a>/gi, "[url=$1][img]$2[/img][/url]" );

	 releaseNotes.val( text );
       } );

     // Skip duplicate checking
     $( "#SkipDuplicateCheckingButton" ).click( function()
       {
	 if ( $( this ).is( ":checked" ) )
	 {
	   $( "html" ).addClass( 'busy' );

	   $.ajax(
	     {
	       type: "GET",
	       url: "{% url "jobs_get_latest" %}",
	       dataType: "json",
	       data: {
		 "PtpOrImdbLink": $( "#imdb" ).val()
	       },
	       success: function( data )
	       {
		 if ( data.Result == "OK" )
		   FinishSkipDuplicateCheckingAjaxCall( data.TorrentId, data.UploadedAgo );
		 else
		   FinishSkipDuplicateCheckingAjaxCall( 0, "" );
	       },
	       error: function()
	       {
		 FinishSkipDuplicateCheckingAjaxCall( 0, "" );
	       }
	     } );
	 }
	 else
	 {
	   $( "#SkipDuplicateCheckingMessage" ).html( "" );
	 }
       } );
   } );
  </script>

{% endblock %}
